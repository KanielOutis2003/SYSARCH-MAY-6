<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - CSS SIT-IN MONITORING SYSTEM</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-image: url('/static/uc.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: rgba(0, 0, 0, 0.5);
            background-blend-mode: overlay;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #003366;
        }

        .user-info {
            text-align: right;
            color: #003366;
        }

        .content-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h2 {
            color: #003366;
            margin-top: 0;
            border-bottom: 2px solid #003366;
            padding-bottom: 10px;
        }

        .student-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .student-table th, .student-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .student-table th {
            background-color: #003366;
            color: white;
            font-weight: 600;
        }

        .student-table tr:hover {
            background-color: rgba(0, 51, 102, 0.05);
        }

        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .action-btn.reset-btn {
            background-color: #ffc107;
            color: #000;
            border: 1px solid #ffc107;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn.reset-btn:hover {
            background-color: #ffca2c;
            border-color: #ffca2c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .action-btn.reset-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .view-btn {
            background-color: #003366;
            color: white;
        }

        .edit-btn {
            background-color: #28a745;
            color: white;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }

        .logout-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background-color: #c82333;
        }

        .flash-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .flash-message {
            padding: 15px 25px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s ease;
            transition: opacity 0.5s ease;
        }

        .flash-success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .flash-error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .flash-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .search-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* Search results styling */
        .search-results {
            position: absolute;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            margin-top: 5px;
        }
        
        .search-result-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .search-result-item:hover {
            background-color: #f0f7ff;
        }
        
        .no-results {
            padding: 10px 15px;
            color: #666;
            font-style: italic;
        }
        
        .search-student-container {
            position: relative;
        }
        
        .selected-student-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .selected-student-header {
            font-weight: bold;
            margin-bottom: 5px;
            color: #003366;
        }
        
        .selected-student-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .student-id, .student-name, .student-course {
            padding: 5px 10px;
            background-color: #e9ecef;
            border-radius: 3px;
            font-size: 14px;
        }

        .search-btn {
            padding: 10px 20px;
            background-color: #003366;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background-color: #004d99;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }

        .page-btn {
            padding: 8px 15px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn.active {
            background-color: #003366;
            color: white;
            border-color: #003366;
        }

        .page-btn:hover:not(.active) {
            background-color: #e0e0e0;
        }

        /* Admin Dashboard Header */
        .admin-header {
            background: #ffffff;
            padding: 20px;
            color: #2c3e50;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .admin-nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-width: 100%;
            align-items: center;
        }
        
        .nav-item {
            padding: 10px 16px;
            cursor: pointer;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            background: #f8f9fa;
            flex: 0 0 auto;
            min-width: 130px;
            font-size: 14px;
            font-weight: 500;
            height: 42px;
            box-sizing: border-box;
            border: 1px solid rgba(0, 0, 0, 0.05);
            color: #2c3e50;
        }
        
        .nav-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .nav-item.active {
            background: #2c3e50;
            color: white;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .nav-item i {
            font-size: 16px;
            width: 16px;
            text-align: center;
            color: inherit;
        }
        
        .nav-item span {
            white-space: nowrap;
            line-height: 1;
        }
        
        @media (max-width: 1200px) {
            .admin-header {
                padding: 15px;
            }
            
            .nav-item {
                padding: 8px 14px;
                font-size: 13px;
                min-width: 120px;
                height: 38px;
            }
            
            .nav-item i {
                font-size: 15px;
                width: 18px;
            }
        }
        
        /* Dashboard Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-card i {
            font-size: 36px;
            color: #003366;
            margin-bottom: 10px;
        }

        .stat-card h3 {
            margin: 0;
            font-size: 28px;
            color: #003366;
        }

        .stat-card p {
            margin: 5px 0 0;
            color: #666;
            font-size: 14px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #003366;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ced4da;
            font-size: 14px;
        }

        .btn-primary {
            background-color: #003366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #004d99;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 70%;
            max-width: 800px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover {
            color: black;
        }

        /* Export Buttons */
        .export-buttons {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .export-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn i {
            font-size: 16px;
        }

        .export-btn.csv {
            background-color: #28a745;
            color: white;
        }

        .export-btn.pdf {
            background-color: #dc3545;
            color: white;
        }

        .export-btn.excel {
            background-color: #217346;
            color: white;
        }

        .export-btn.print {
            background-color: #6c757d;
            color: white;
        }

        .export-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Student Details */
        .student-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .student-photo {
            text-align: center;
        }

        .student-photo img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #003366;
            margin-bottom: 15px;
        }

        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-item {
            margin-bottom: 10px;
        }

        .info-item label {
            font-weight: 600;
            color: #003366;
            display: block;
            margin-bottom: 5px;
        }

        .info-item span {
            display: block;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        /* Programming Languages */
        .language-selector {
            margin-top: 20px;
        }

        .language-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .language-option {
            padding: 8px 15px;
            background-color: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-option.selected {
            background-color: #003366;
            color: white;
        }

        .language-option:hover {
            background-color: #e0e0e0;
        }

        .language-option.selected:hover {
            background-color: #004d99;
        }

        /* Language Stats */
        .language-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .language-stat {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .language-stat h4 {
            margin: 0 0 10px 0;
            color: #003366;
        }

        .language-stat p {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            color: #003366;
        }

        /* Reports Tab */
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .chart-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 300px;
        }

        .chart-title {
            color: #003366;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .pie-chart {
            width: 100%;
            height: 300px;
        }

        .export-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn i {
            font-size: 16px;
        }

        .export-btn.csv {
            background-color: #28a745;
            color: white;
        }

        .export-btn.pdf {
            background-color: #dc3545;
            color: white;
        }

        .export-btn.excel {
            background-color: #217346;
            color: white;
        }

        .export-btn.print {
            background-color: #6c757d;
            color: white;
        }

        .export-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Welcome Card */
        .welcome-card {
            background: linear-gradient(135deg, #4a89dc, #6a5acd);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            color: white;
            text-align: center;
        }
        
        .welcome-card h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .welcome-card p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #4a89dc;
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        
        .stat-card p {
            font-size: 1rem;
            color: #666;
            margin: 0;
        }
        
        .stat-card:nth-child(1) i { color: #4a89dc; }
        .stat-card:nth-child(2) i { color: #2ecc71; }
        .stat-card:nth-child(3) i { color: #f39c12; }
        .stat-card:nth-child(4) i { color: #e74c3c; }
        
        .recent-activity {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .recent-activity h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a89dc;
        }
        
        .language-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .language-summary h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a89dc;
        }
        
        /* Sessions tabs styling */
        #sessions {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        #sessions h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a89dc;
        }
        
        #sessions .student-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        #sessions .student-table th {
            background-color: #4a89dc;
            color: white;
        }

        /* Enhanced dashboard styling */
        .welcome-card {
            background: linear-gradient(135deg, #4a89dc, #6a5acd);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            color: white;
            text-align: center;
        }
        
        .welcome-card h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .welcome-card p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #4a89dc;
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        
        .stat-card p {
            font-size: 1rem;
            color: #666;
            margin: 0;
        }
        
        .stat-card:nth-child(1) i { color: #4a89dc; }
        .stat-card:nth-child(2) i { color: #2ecc71; }
        .stat-card:nth-child(3) i { color: #f39c12; }
        .stat-card:nth-child(4) i { color: #e74c3c; }
        
        .recent-activity {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .recent-activity h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a89dc;
        }
        
        .language-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .language-summary h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a89dc;
        }
        
        /* Sessions tabs styling */
        #sessions {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        #sessions h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a89dc;
        }
        
        #sessions .student-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        #sessions .student-table th {
            background-color: #4a89dc;
            color: white;
        }

        /* Ensure consistent background across tabs */
        #forms, #dashboard, #students, #sessions, #pending, #feedback, #announcements, #reports, #settings {
            background-color: #fff;
        }

        /* Profile picture in modal */
        .profile-picture img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid #3498db;
        }
        
        /* Student profile layout in modal */
        .student-profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .profile-details {
            margin-left: 20px;
        }
        
        .profile-details h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .profile-details p {
            margin: 5px 0;
            color: #555;
        }

        /* Enhanced Student Modal Styles */
        .modal-title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .student-info-container {
            padding: 10px;
        }
        
        /* Student Profile Card */
        .student-profile-card {
            display: flex;
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #3498db;
        }
        
        .profile-picture-container {
            flex: 0 0 100px;
        }
        
        .profile-picture-container img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #3498db;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .profile-details-container {
            flex: 1;
            margin-left: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .profile-details-container h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            color: #555;
        }
        
        .detail-item i {
            width: 20px;
            margin-right: 10px;
            color: #3498db;
        }
        
        /* Session Details Card */
        .session-details-card {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #e74c3c;
        }
        
        .card-title {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 10px;
            color: #e74c3c;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn-update {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .btn-update i {
            margin-right: 8px;
        }
        
        .btn-update:hover {
            background-color: #2980b9;
        }
        
        /* Action Buttons */
        .action-buttons-container, 
        .approval-buttons-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn.reset-btn {
            background-color: #ffc107;
            color: #000;
            border: 1px solid #ffc107;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn.reset-btn:hover {
            background-color: #ffca2c;
            border-color: #ffca2c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn.reset-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }
        
        .action-btn i {
            margin-right: 8px;
        }
        
        .check-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .check-btn:hover {
            background-color: #27ae60;
        }
        
        .end-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .end-btn:hover {
            background-color: #c0392b;
        }
        
        .approve-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .approve-btn:hover {
            background-color: #27ae60;
        }
        
        .reject-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .reject-btn:hover {
            background-color: #c0392b;
        }

        .btn-edit:hover {
            background-color: #218838;
        }
        
        .reset-semester-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .reset-semester-btn:hover {
            background-color: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        
        .reset-semester-btn i {
            font-size: 18px;
        }
        
        /* Flash message styles */
        /* Dropdown styles */
        .nav-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #ffffff;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-radius: 5px;
            z-index: 1000;
            min-width: 160px;
            right: 0;
        }
        
        .nav-dropdown:hover .dropdown-content {
            display: block;
        }
        
        .dropdown-item {
            color: #003366;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
            transition: background-color 0.3s;
        }
        
        .dropdown-item:hover {
            background-color: #f1f1f1;
        }
        
        .dropdown-item i {
            margin-right: 8px;
            font-size: 14px;
        }
        
        /* ... continuing with existing styles ... */
        .nav-dropdown.active .dropdown-content {
            display: block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            min-width: 180px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        .dropdown-item {
            display: block;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover {
            background-color: #f5f5f5;
        }
        
        .dropdown-item i {
            margin-right: 8px;
            color: #3498db;
        }

        .reject-btn:hover {
            background-color: #c0392b;
        }
        
        .reward-btn {
            background-color: #9b59b6;
            color: white;
        }
        
        .reward-btn:hover {
            background-color: #8e44ad;
        }

        /* Enhanced styles for admin cards, search boxes, and data tables */
        .admin-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .card-header {
            background-color: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            margin: 0;
            color: #003366;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-body {
            padding: 20px;
        }

        .search-box {
            display: flex;
            gap: 10px;
        }

        .search-input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            min-width: 250px;
        }

        .search-btn {
            background-color: #003366;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-btn:hover {
            background-color: #002244;
        }

        .table-responsive {
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table th {
            background-color: #003366;
            color: white;
            padding: 12px 15px;
            text-align: left;
            border-bottom: 2px solid #e9ecef;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 10px;
            color: #adb5bd;
        }

        .btn-action {
            background-color: transparent;
            border: none;
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            color: #495057;
            margin-right: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn {
            color: #007bff;
        }

        .view-btn:hover {
            background-color: rgba(0, 123, 255, 0.1);
        }

        .approve-btn {
            color: #28a745;
        }

        .approve-btn:hover {
            background-color: rgba(40, 167, 69, 0.1);
        }

        .reject-btn {
            color: #dc3545;
        }

        .reject-btn:hover {
            background-color: rgba(220, 53, 69, 0.1);
        }

        .check-in-btn {
            color: #17a2b8;
        }

        .check-in-btn:hover {
            background-color: rgba(23, 162, 184, 0.1);
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            text-transform: uppercase;
        }

        .status-badge.rejected {
            background-color: #ffebee;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
        }

        .status-badge.completed {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .status-badge.cancelled {
            background-color: #ffe0b2;
            color: #ef6c00;
            border: 1px solid #ffcc80;
        }

        .status-badge.pending {
            background-color: #fff8e1;
            color: #ff8f00;
            border: 1px solid #ffecb3;
        }

        .status-badge.active {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }

        /* Course badges */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-primary {
            background-color: #cfe2ff;
            color: #0a58ca;
        }

        .badge-success {
            background-color: #d1e7dd;
            color: #146c43;
        }

        .badge-info {
            background-color: #cff4fc;
            color: #087990;
        }

        .badge-secondary {
            background-color: #e2e3e5;
            color: #41464b;
        }

        /* Computer Control styles */
        .computer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .computer-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .computer-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .computer-item.vacant {
            border-left: 5px solid #28a745;
        }
        
        .computer-item.occupied, .computer-item.in-use {
            border-left: 5px solid #dc3545;
        }
        
        .computer-item.maintenance {
            border-left: 5px solid #6c757d;
        }
        
        .computer-icon {
            font-size: 36px;
            color: #495057;
            margin-bottom: 10px;
        }
        
        .computer-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .computer-status {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .computer-item.vacant .computer-status {
            color: #28a745;
        }
        
        .lab-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #003366;
            text-align: center;
            padding: 10px;
            border-bottom: 2px solid #003366;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 40px;
            font-size: 24px;
            color: #6c757d;
        }
        
        .loading-spinner i {
            margin-right: 10px;
        }
        
        .computer-details {
            padding: 15px;
        }
        
        .detail-item {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .detail-label {
            font-weight: bold;
            width: 120px;
        }
        
        .detail-value {
            flex: 1;
        }
        
        .detail-value.vacant {
            color: #28a745;
            font-weight: bold;
        }
        
        .detail-value.occupied {
            color: #dc3545;
            font-weight: bold;
        }
        
        .detail-value.maintenance {
            color: #6c757d;
            font-weight: bold;
        }
        
        .detail-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Status Summary styles */
        .status-summary {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 20px;
        }
        
        .status-label {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-label.vacant {
            color: #28a745;
        }
        
        .status-label.occupied {
            color: #dc3545;
        }
        
        .status-label.maintenance {
            color: #6c757d;
        }
        
        .status-count {
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* Status indicators for PC Control */
        .vacant {
            color: #28a745;
        }
        
        .occupied {
            color: #dc3545;
        }
        
        .maintenance {
            color: #6c757d;
        }
        
        /* Status summary in PC Control */
        .status-summary {
            display: flex;
            justify-content: space-between;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .status-item {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
        }
        
        .status-label {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .status-count {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        /* Action buttons */
        .reward-btn {
            background-color: #fd7e14;
            color: white;
        }
        
        .reward-btn:hover {
            background-color: #e67211;
        }
        
        .bulk-actions {
            display: inline-flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* Quick navigation links */
        .quick-nav-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .quick-nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            border-radius: 5px;
            color: #003366;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .quick-nav-btn:hover {
            background-color: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: #0056b3;
        }
        
        .quick-nav-btn i {
            font-size: 14px;
        }

        /* Add styles for date filter container */
        .date-filter-container {
            margin-bottom: 20px;
        }
        
        .date-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .date-input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .filter-btn {
            background-color: #003366;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .filter-btn:hover {
            background-color: #002244;
        }
        
        /* Make sure export buttons are properly spaced */
        .export-btn {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .computer-item.occupied, .computer-item.in-use {
            border-left: 5px solid #dc3545;
        }
        
        .computer-item.maintenance {
            border-left: 5px solid #6c757d;
        }
        
        .computer-icon {
            font-size: 36px;
            color: #495057;
            margin-bottom: 10px;
        }

        .computer-item.occupied .computer-status, .computer-item.in-use .computer-status {
            color: #dc3545;
        }
        
        .computer-item.maintenance .computer-status {
            color: #6c757d;
        }

        .detail-value.occupied, .detail-value.in-use {
            color: #dc3545;
            font-weight: bold;
        }
        
        .detail-value.maintenance {
            color: #6c757d;
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Flash Messages Container -->
    <div class="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="dashboard-container">
        <div class="header">
            <div class="logo-section">
                <img src="/static/CSS.png" alt="CSS Logo" class="logo">
                <h1>Admin Dashboard</h1>
            </div>
            <div class="user-info">
                <h3>Welcome, Admin</h3>
                <a href="{{ url_for('logout') }}"><button class="logout-btn">Logout</button></a>
            </div>
        </div>

        <!-- Admin Navigation Header -->
        <div class="admin-header">
            <div class="admin-nav">
                <div class="nav-item active" onclick="showTab('dashboard');">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showTab('computer_control');">
                    <i class="fas fa-desktop"></i>
                    <span>Computer Control</span>
                </div>
                <div class="nav-item" onclick="showTab('sessions');">
                    <i class="fas fa-calendar-check"></i>
                    <span>Current Sessions</span>
                </div>
                <div class="nav-item" onclick="showTab('forms');">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Reservation Forms</span>
                </div>
                <div class="nav-item" onclick="showTab('students');">
                    <i class="fas fa-user-graduate"></i>
                    <span>Students</span>
                </div>
                <div class="nav-item" onclick="showTab('feedback');">
                    <i class="fas fa-comment-alt"></i>
                    <span>Feedback</span>
                </div>
                <div class="nav-item" onclick="showTab('announcements');">
                    <i class="fas fa-bullhorn"></i>
                    <span>Announcements</span>
                </div>
                <div class="nav-item" onclick="showTab('reports');">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </div>
                <div class="nav-item" onclick="window.location.href='/admin/leaderboard';">
                    <i class="fas fa-trophy"></i>
                    <span>Leaderboard</span>
                </div>
                <div class="nav-item" onclick="window.location.href='/admin/lab-resources';">
                    <i class="fas fa-book"></i>
                    <span>Lab Resources</span>
                </div>
                <div class="nav-item" onclick="window.location.href='/todays-sit-ins';">
                    <i class="fas fa-calendar-day"></i>
                    <span>Today's Sit-ins</span>
                </div>
                <div class="nav-item" onclick="window.location.href='/sit_in_history';">
                    <i class="fas fa-history"></i>
                    <span>Sit-in History</span>
                </div>
                <div class="nav-item" onclick="window.location.href='/admin_lab_schedules';">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Lab Schedules</span>
                </div>
                <div class="nav-item" onclick="showTab('settings');">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Content -->
        <div id="dashboard" class="tab-content active">
            <!-- Welcome Card - Enhanced design -->
            <div class="welcome-card">
                <h3>Welcome to Your Admin Dashboard</h3>
                <p>{{ today_date }}</p>
            </div>
            
            <!-- Dashboard Stats Cards - Renamed Active Sessions to Active Forms -->
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-user-graduate"></i>
                    <h3>{{ students|length }}</h3>
                    <p>Total Students</p>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3>{{ active_sessions|length|default(0) }}</h3>
                    <p>Current Sit-ins</p>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-calendar-check"></i>
                    <h3>{{ active_sessions|length }}</h3>
                    <p>PCs in Use</p>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-clock"></i>
                    <h3>{{ pending_sessions|length }}</h3>
                    <p>Pending Requests</p>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <table class="student-table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Lab Room</th>
                            <th>Action</th>
                            <th>Date</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for activity in recent_activity %}
                            <tr>
                                <td>{{ activity.firstname }} {{ activity.lastname }}</td>
                                <td>{{ activity.lab_room|lab_room }}</td>
                                <td>{{ activity.action }}</td>
                                <td>{{ activity.timestamp_date }}</td>
                                <td>{{ activity.timestamp_time }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Top Programming Languages -->
            <div class="language-summary">
                <h3>Top Programming Languages</h3>
                <div class="language-tags">
                    {% for lang in language_stats|sort(attribute='count', reverse=True) %}
                        {% if loop.index <= 6 %}
                            {% if lang.count > 0 %}
                                <div class="language-tag">
                                    <span>{{ lang.programming_language }}</span>
                                    <span class="lang-count">{{ lang.count }}</span>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Sessions Tab: Current Sessions - Only show checked-in students -->
        <div id="sessions" class="tab-content">
            <h2>Current Sessions</h2>
            
            <div class="search-bar">
                <input type="text" id="dashboardSearchInput" class="search-input" placeholder="Search by name, ID, or lab room...">
                <button class="search-btn" onclick="searchDashboard()">Search</button>
                <button class="search-btn" style="background-color: #28a745;" onclick="showDirectSitInModal()">Direct Sit In</button>
            </div>
            
                <table class="student-table">
                    <thead>
                        <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Course</th>
                            <th>Lab Room</th>
                            <th>Date & Time</th>
                        <th>Purpose</th>
                        <th>Status</th>
                        <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% if active_sessions|length > 0 %}
                        {% for session in active_sessions %}
                            <tr>
                                <td>{{ session.idno }}</td>
                                <td>{{ session.lastname }}, {{ session.firstname }}</td>
                                <td>
                                    {% if session.course == '1' %}
                                        BSIT
                                    {% elif session.course == '2' %}
                                        BSCS
                                    {% elif session.course == '3' %}
                                        BSCE
                                    {% else %}
                                        {{ session.course }}
                                    {% endif %}
                                </td>
                                <td>{{ session.lab_room|lab_room }}</td>
                                <td>{{ session.date_time_formatted }}</td>
                                <td>{{ session.purpose|default('N/A')|truncate(30) }}</td>
                                <td>
                                    <span class="status-active">Checked In</span>
                                </td>
                                <td class="action-buttons">
                                    <form action="{{ url_for('check_out_student', session_id=session.id) }}" method="POST" style="display:inline;">
                                        <button type="submit" class="action-btn delete-btn">Check Out</button>
                                    </form>
                                    <form action="{{ url_for('check_out_student_with_reward', session_id=session.id) }}" method="POST" style="display:inline;">
                                        <button type="submit" class="action-btn reward-btn">End with Reward</button>
                                    </form>
                                </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                            <td colspan="8" style="text-align: center;">No students currently checked in</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
        </div>

        <!-- Pending Requests Tab -->
        <div id="forms" class="tab-content">
            <div class="admin-card">
                <div class="card-header">
                    <h2><i class="fas fa-clock"></i> Pending Requests</h2>
                </div>
                <div class="card-body">
                    {% if pending_sessions|length > 0 %}
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Name</th>
                                    <th>Course</th>
                                    <th>Lab Room</th>
                                    <th>Date & Time</th>
                                    <th>Purpose</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for session in pending_sessions %}
                                <tr>
                                    <td>{{ session.idno }}</td>
                                    <td>{{ session.lastname }}, {{ session.firstname }}</td>
                                    <td>
                                        {% if session.course == '1' %}
                                        BSIT
                                        {% elif session.course == '2' %}
                                        BSCS
                                        {% elif session.course == '3' %}
                                        BSCE
                                        {% else %}
                                        {{ session.course }}
                                        {% endif %}
                                    </td>
                                    <td>{{ session.lab_room|lab_room }}</td>
                                    <td>{{ session.date_time_formatted }}</td>
                                    <td>{{ session.purpose|default('N/A')|truncate(30) }}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <form action="{{ url_for('approve_session', session_id=session.id) }}" method="post" style="display: inline;">
                                                <button type="submit" class="approve-btn">Approve</button>
                                            </form>
                                            <form action="{{ url_for('reject_session', session_id=session.id) }}" method="post" style="display: inline;">
                                                <button type="submit" class="reject-btn">Reject</button>
                                            </form>
                                            <button type="button" class="edit-btn" onclick="editSession('{{ session.id }}', '{{ session.lab_room }}', '{{ session.programming_language }}', '{{ session.purpose|replace("'", "\\'") }}')">Edit</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-calendar-xmark"></i>
                        <p>No pending requests at the moment.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Approved Reservations Section removed - now approved requests go directly to Current Sessions -->
            <div class="admin-card">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> Reservation Logs</h2>
                    
                    <!-- Add search functionality -->
                    <div class="search-box">
                        <input type="text" id="logsSearchInput" placeholder="Search logs..." class="search-input">
                        <button onclick="searchLogs()" class="search-btn"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    {% if reservation_logs|length > 0 %}
                    <div class="table-responsive">
                        <table class="data-table" id="logsTable">
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Name</th>
                                    <th>Course</th>
                                    <th>Lab Room</th>
                                    <th>Date & Time</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for session in reservation_logs %}
                                <tr>
                                    <td>{{ session.idno }}</td>
                                    <td>{{ session.lastname }}, {{ session.firstname }}</td>
                                    <td>
                                        {% if session.course == '1' %}
                                            BSIT
                                        {% elif session.course == '2' %}
                                            BSCS
                                        {% elif session.course == '3' %}
                                            BSCE
                                        {% else %}
                                            {{ session.course }}
                                        {% endif %}
                                    </td>
                                    <td>{{ session.lab_room|lab_room }}</td>
                                    <td>{{ session.date_time_formatted }}</td>
                                    <td title="{{ session.purpose }}">{{ session.purpose[:30] }}{% if session.purpose|length > 30 %}...{% endif %}</td>
                                    <td>
                                        {% if session.approval_status == 'rejected' %}
                                            <span class="status-badge rejected">Rejected</span>
                                        {% elif session.approval_status == 'approved' %}
                                            <span class="status-badge approved">Approved</span>
                                        {% elif session.approval_status == 'pending' %}
                                            <span class="status-badge pending">Pending</span>
                                        {% else %}
                                            <span class="status-badge {{ session.approval_status }}">{{ session.approval_status|capitalize }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>No reservation logs available.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- The second Reservation Logs Section is removed to fix duplication -->
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
                <h2>Usage Reports</h2>
                
                <div class="date-filter-container">
                    <div class="date-filter">
                        <label for="reportStartDate">From:</label>
                        <input type="date" id="reportStartDate" class="date-input">
                        
                        <label for="reportEndDate">To:</label>
                        <input type="date" id="reportEndDate" class="date-input">
                        
                        <button id="filterReportBtn" class="filter-btn" onclick="filterReportsByDate()">
                            <i class="fas fa-filter"></i> Filter Reports
                        </button>
                    </div>
                </div>
            
                <a href="{{ url_for('export_report', format='excel') }}" class="export-btn excel" id="exportExcelBtn">
                    <i class="fas fa-file-excel"></i> Export as Excel
                </a>
                <a href="{{ url_for('export_report', format='csv') }}" class="export-btn csv" id="exportCSVBtn">
                    <i class="fas fa-file-csv"></i> Export as CSV
                </a>
                <a href="{{ url_for('export_report', format='pdf') }}" class="export-btn pdf" id="exportPDFBtn">
                    <i class="fas fa-file-pdf"></i> Export as PDF
                </a>
                <button class="export-btn print" onclick="window.print()">
                    <i class="fas fa-print"></i> Print Report
                </button>
                
            <div class="chart-container">
                <div class="chart-card">
                    <div class="chart-title">Lab Room Usage</div>
                    <div class="pie-chart">
                        <canvas id="labRoomChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">Report Statistics</div>
                    <div class="pie-chart">
                        <canvas id="reportStatsChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="chart-container" style="margin-top: 20px;">
                <div class="chart-card">
                    <div class="chart-title">Course Distribution</div>
                    <div class="pie-chart">
                        <canvas id="courseChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">Session Purpose Distribution</div>
                    <div class="pie-chart">
                        <canvas id="purposeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="content-section">
                <h2>System Settings</h2>
                
                <form id="settingsForm">
                    <div class="form-group">
                        <label for="maxSessionsBSIT">Maximum Sessions for BSIT Students</label>
                        <input type="number" id="maxSessionsBSIT" class="form-control" value="30">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxSessionsBSCS">Maximum Sessions for BSCS Students</label>
                        <input type="number" id="maxSessionsBSCS" class="form-control" value="30">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxSessionsBSCE">Maximum Sessions for BSCE Students</label>
                        <input type="number" id="maxSessionsBSCE" class="form-control" value="30">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxSessionsOther">Maximum Sessions for Other Students</label>
                        <input type="number" id="maxSessionsOther" class="form-control" value="25">
                    </div>
                    
                    <div class="form-group">
                        <label for="adminPassword">Change Admin Password</label>
                        <input type="password" id="adminPassword" class="form-control" placeholder="Enter new password">
                    </div>
                    
                    <button type="button" class="btn-primary" onclick="saveSettings()">Save Settings</button>
                </form>
                
                <hr class="my-4">
                
                <h3>Semester Management</h3>
                <div class="alert alert-warning">
                    <strong>Warning:</strong> Resetting the semester will reset session counts for all students to zero. This action cannot be undone.
                </div>
                <form action="{{ url_for('reset_semester') }}" method="POST">
                    <button type="submit" class="reset-semester-btn" onclick="return confirm('WARNING: This will reset session counts for ALL students back to zero. This action cannot be undone. Are you sure you want to proceed?')">
                        <i class="fas fa-redo"></i> RESET SEMESTER
                    </button>
                </form>
            </div>
        </div>

        <!-- Feedback Tab -->
        <div id="feedback" class="tab-content">
            <div class="content-section">
                <h2>Student Feedback</h2>
                
                <div class="search-bar">
                    <input type="text" id="feedbackSearchInput" class="search-input" placeholder="Search by student name, ID, or comments...">
                    <button class="search-btn" onclick="searchFeedback()">Search</button>
                </div>
                
                <!-- Feedback Statistics -->
                <div class="stats-container">
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <h3>{{ feedback_stats.average_rating|default('0.0') }}</h3>
                        <p>Average Rating</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-comment"></i>
                        <h3>{{ feedback_stats.total_feedback|default(0) }}</h3>
                        <p>Total Feedback</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-thumbs-up"></i>
                        <h3>{{ feedback_stats.positive_feedback|default(0) }}</h3>
                        <p>Positive Feedback</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-thumbs-down"></i>
                        <h3>{{ feedback_stats.negative_feedback|default(0) }}</h3>
                        <p>Negative Feedback</p>
                    </div>
                </div>
                
                <table class="student-table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Lab Room</th>
                            <th>Date</th>
                            <th>Rating</th>
                            <th>Comments</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if feedback_list %}
                            {% for feedback in feedback_list %}
                                <tr>
                                    <td>{{ feedback.lastname }}, {{ feedback.firstname }}</td>
                                    <td>{{ feedback.lab_room|lab_room }}</td>
                                    <td>{{ feedback.created_at.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        {% for i in range(1, 6) %}
                                            {% if i <= feedback.rating %}
                                                <i class="fas fa-star" style="color: gold;"></i>
                                            {% else %}
                                                <i class="far fa-star" style="color: #ccc;"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td>{{ feedback.comments }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" style="text-align: center;">No feedback submitted yet</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Announcements Tab -->
        <div id="announcements" class="tab-content">
            <div class="content-section">
                <h2>Announcements</h2>
                
                <!-- Add Announcement Form -->
                <div class="add-announcement-form" style="margin-bottom: 30px;">
                    <h3>Add New Announcement</h3>
                    <form action="/admin/add_announcement" method="POST">
                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" name="title" id="title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="content">Content</label>
                            <textarea name="content" id="content" class="form-control" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Post Announcement</button>
                    </form>
                </div>
                
                <!-- Announcements List -->
                <h3>Current Announcements</h3>
                <table class="student-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Content</th>
                            <th>Date Posted</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if announcements %}
                            {% for announcement in announcements %}
                                <tr>
                                    <td>{{ announcement.title }}</td>
                                    <td>{{ announcement.content|truncate(100) }}</td>
                                    <td>{{ announcement.created_at.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        {% if announcement.is_active %}
                                            <span class="status-active">Active</span>
                                        {% else %}
                                            <span class="status-inactive">Inactive</span>
                                        {% endif %}
                                    </td>
                                    <td class="action-buttons">
                                        <button type="button" class="action-btn view-btn" onclick="editAnnouncement('{{ announcement.id }}');">
                                            Edit
                                        </button>
                                        <form action="{{ url_for('toggle_announcement', announcement_id=announcement.id) }}" method="POST" style="display: inline;">
                                            <button type="submit" class="action-btn edit-btn">
                                                {% if announcement.is_active %}
                                                    Deactivate
                                                {% else %}
                                                    Activate
                                                {% endif %}
                                            </button>
                                        </form>
                                        <form action="{{ url_for('delete_announcement', announcement_id=announcement.id) }}" method="POST" style="display: inline;">
                                            <button type="submit" class="action-btn delete-btn" onclick="return confirm('Are you sure you want to delete this announcement?')">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" style="text-align: center;">No announcements yet</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="content-section">
                <h2>Student Management</h2>
                
                <div class="search-bar">
                    <input type="text" id="studentSearchInput" class="search-input" placeholder="Search by name, ID, or course...">
                    <button class="search-btn" onclick="searchStudents()">Search</button>
                </div>
                
                <table class="student-table">
                    <thead>
                        <tr>
                            <th>Profile</th>
                            <th>ID Number</th>
                            <th>Name</th>
                            <th>Course</th>
                            <th>Sessions Used</th>
                            <th>Max Sessions</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if students %}
                            {% for student in students %}
                                <tr>
                                    <td>
                                        <img src="/static/profile_pictures/{{ student.profile_picture }}" alt="Profile" class="profile-pic">
                                    </td>
                                    <td>{{ student.idno }}</td>
                                    <td>{{ student.lastname }}, {{ student.firstname }} {% if student.middlename %}{{ student.middlename[0] }}.{% endif %}</td>
                                    <td>
                                        {% if student.course == '1' %}
                                            BSIT
                                        {% elif student.course == '2' %}
                                            BSCS
                                        {% elif student.course == '3' %}
                                            BSCE
                                        {% else %}
                                            {{ student.course }}
                                        {% endif %}
                                    </td>
                                    <td>{{ student.sessions_used|default(0) }} / {{ student.max_sessions|default(25) }}</td>
                                    <td>{{ student.max_sessions|default(25) }}</td>
                                    <td class="action-buttons">
                                        <button class="action-btn view-btn" onclick="viewStudent('{{ student.id }}')">View</button>
                                        <button class="action-btn edit-btn" onclick="editStudent('{{ student.id }}')">Edit</button>
                                        <button class="action-btn delete-btn" onclick="deleteStudent('{{ student.id }}')">Delete</button>
                                        <form action="{{ url_for('reset_student_sessions', student_id=student.id) }}" method="POST" style="display: inline;">
                                            <button type="submit" class="action-btn reset-btn" onclick="return confirm('Are you sure you want to reset this student\'s session count to zero?')">
                                                <i class="fas fa-redo"></i> Reset Sessions
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="7" style="text-align: center;">No students found</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
                
                <div class="pagination">
                    <button class="page-btn">Previous</button>
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">3</button>
                    <button class="page-btn">Next</button>
                </div>
            </div>
        </div>
        
        <!-- Computer Control Tab -->
        <div id="computer_control" class="tab-content">
            <h2>Computer Control Module</h2>
            
            <div class="search-bar">
                <select id="labRoomFilter" class="search-input" onchange="filterComputersByLab()">
                    <option value="">Select Lab Room</option>
                    <option value="Lab 1">Lab 524</option>
                    <option value="Lab 2">Lab 526</option>
                    <option value="Lab 3">Lab 528</option>
                    <option value="Lab 4">Lab 530</option>
                    <option value="Lab 5">Lab 532</option>
                    <option value="Lab 6">Lab 540</option>
                    <option value="Lab 7">Lab 544</option>
                </select>
                <button class="search-btn" onclick="filterComputersByLab()">Filter</button>
                
                <!-- Bulk Actions Section -->
                <div class="bulk-actions" style="margin-left: 20px;">
                    <select id="pcSelectionFilter" class="search-input">
                        <option value="none">Select PCs</option>
                        <option value="all">All PCs</option>
                        <option value="available">Available PCs</option>
                        <option value="occupied">Occupied PCs</option>
                    </select>
                    <select id="bulkActionType" class="search-input">
                        <option value="">Bulk Action</option>
                        <option value="vacant">Set as Available</option>
                        <option value="occupied">Set as Occupied</option>
                        <option value="maintenance">Set as Under Maintenance</option>
                    </select>
                    <button class="search-btn" onclick="applyBulkAction()">Apply</button>
                </div>
            </div>
            
            <div id="computerControlContent" class="mt-4">
                <div class="text-center p-4 bg-light rounded">
                    <i class="fas fa-desktop fa-3x mb-3 text-muted"></i>
                    <h4>Computer Control Panel</h4>
                    <p>Please select a lab room to view and manage computers.</p>
                    <p class="small text-muted">You'll be able to see the status of all PCs and manage their availability.</p>
                </div>
            </div>
            
            <!-- Computer Details Modal -->
            <div id="computerDetailsModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeComputerModal()">&times;</span>
                    <h2 class="modal-title">Computer Details</h2>
                    <div id="computerDetailsContent">
                        <!-- Computer details will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            // Computer Control functions
            function filterComputersByLab() {
                const selectedLab = document.getElementById('labRoomFilter').value;
                displayComputers(selectedLab);
            }
            
            function displayComputers(labRoom) {
                if (!labRoom) {
                    document.getElementById('computerControlContent').innerHTML = `
                        <div class="alert alert-info">
                            Please select a lab room to view available computers.
                        </div>
                    `;
                    return;
                }
                
                // Show loading indicator
                document.getElementById('computerControlContent').innerHTML = `
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i> Loading PC status...
                    </div>
                `;
                
                // Fetch actual PC status data from the server
                fetch(`/get_pc_status?lab_room=${labRoom}`)
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(errorData => {
                                throw new Error(errorData.error || 'Network response was not ok');
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Check for error in response
                        if (data.error) {
                            throw new Error(data.error);
                        }
                        
                        // Process the data
                        if (!data.pc_status) {
                            throw new Error('Invalid data format received from server');
                        }
                        
                        // Count computers by status
                        const statusCounts = {
                            vacant: 0,
                            occupied: 0,
                            maintenance: 0
                        };
                        
                        // Start building the HTML for the grid
                        let computerGridHTML = `
                            <div class="lab-room-title">
                                <h3>${labRoom}</h3>
                            </div>
                            
                            <div class="status-summary">
                                <div class="status-item">
                                    <div class="status-label">Available</div>
                                    <div class="status-count vacant">0</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Occupied</div>
                                    <div class="status-count occupied">0</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Maintenance</div>
                                    <div class="status-count maintenance">0</div>
                                </div>
                            </div>
                            
                            <div class="computer-grid">
                        `;
                        
                        // Process PC status data and build the grid
                        for (let i = 0; i <= 30; i++) { // Display PCs from 0 to 30
                            const pcKey = i.toString();
                            
                            // If we have data for this PC, use it; otherwise create a default vacant PC
                            if (pcKey in data.pc_status) {
                                const pcData = data.pc_status[pcKey];
                                const status = pcData.status || 'vacant';
                                const studentId = pcData.student_id || null;
                                const sessionId = pcData.session_id || null;
                                const purpose = pcData.purpose || '';
                                
                                // Update count for this status
                                if (status in statusCounts) {
                                    statusCounts[status]++;
                                }
                                
                                // Create computer item with proper status
                                computerGridHTML += `
                                    <div class="computer-item ${status}" 
                                        data-pc="${i}" 
                                        data-status="${status}"
                                        data-student-id="${studentId || ''}"
                                        data-session-id="${sessionId || ''}"
                                        data-purpose="${purpose || ''}"
                                        onclick="showComputerDetails('${labRoom}', ${i}, '${status}', '${studentId || ''}', '${sessionId || ''}', '${purpose || ''}')">
                                        <i class="fas fa-desktop ${status}"></i>
                                        <div>PC ${i}</div>
                                        <div class="status-label ${status}">${getStatusLabel(status)}</div>
                                    </div>
                                `;
                            } else {
                                // Create a default vacant PC if it's not in the data
                                statusCounts.vacant++;
                                
                                computerGridHTML += `
                                    <div class="computer-item vacant" 
                                        data-pc="${i}" 
                                        data-status="vacant"
                                        onclick="showComputerDetails('${labRoom}', ${i}, 'vacant', '', '', '')">
                                        <i class="fas fa-desktop vacant"></i>
                                        <div>PC ${i}</div>
                                        <div class="status-label vacant">${getStatusLabel('vacant')}</div>
                                    </div>
                                `;
                            }
                        }
                        
                        // Close the grid div
                        computerGridHTML += `</div>`;
                        
                        // Display the grid
                        document.getElementById('computerControlContent').innerHTML = computerGridHTML;
                        
                        // Update the status counts
                        document.querySelector('.status-count.vacant').textContent = statusCounts.vacant;
                        document.querySelector('.status-count.occupied').textContent = statusCounts.occupied;
                        document.querySelector('.status-count.maintenance').textContent = statusCounts.maintenance;
                    })
                    .catch(error => {
                        console.error('Error fetching PC status:', error);
                        document.getElementById('computerControlContent').innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle"></i> Failed to load computer status: ${error.message}
                            </div>
                        `;
                    });
            }
            
            function getStatusLabel(status) {
                switch (status) {
                    case 'vacant':
                        return 'Available';
                    case 'occupied':
                        return 'In Use';
                    case 'maintenance':
                        return 'Maintenance';
                    default:
                        return status.charAt(0).toUpperCase() + status.slice(1);
                }
            }
            
            function showComputerDetails(labRoom, pcNumber, status, studentId, sessionId, purpose) {
                let content = `
                    <div class="computer-details">
                        <h3>PC ${pcNumber} in ${labRoom}</h3>
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value ${status}">${getStatusLabel(status)}</span>
                        </div>
                `;
                
                if (status === 'occupied') {
                    // If occupied, fetch and show student info if studentId is valid
                    if (studentId && studentId !== 'null' && studentId !== null) {
                        // Show loading indicator for student info
                        document.getElementById('computerDetailsContent').innerHTML = content + `
                            <div class="text-center mt-3">
                                <i class="fas fa-spinner fa-spin"></i> Loading student information...
                            </div>
                        `;
                        
                        fetch(`/admin/get-student-info/${studentId}`)
                        .then(response => response.json())
                        .then(studentData => {
                            const studentInfo = studentData.student || { firstname: 'Unknown', lastname: 'Student', idno: 'N/A' };
                            
                                content += `
                                <div class="detail-item">
                                    <span class="detail-label">Assigned To:</span>
                                    <span class="detail-value">${studentInfo.firstname} ${studentInfo.lastname} (${studentInfo.idno})</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Purpose:</span>
                                    <span class="detail-value">${purpose || 'Not specified'}</span>
                                </div>
                                `;
                                
                                content += `
                                <div class="detail-actions">
                                    <button class="action-btn end-btn" onclick="updatePCStatus('${labRoom}', ${pcNumber}, 'vacant')">Set as Vacant</button>
                                </div>
                            `;
                                
                                content += `</div>`;
                                document.getElementById('computerDetailsContent').innerHTML = content;
                        })
                        .catch(error => {
                            console.error('Error fetching student info:', error);
                                
                                content += `
                                    <div class="alert alert-danger mt-3">
                                        Failed to load student information.
                                    </div>
                                    <div class="detail-actions">
                                        <button class="action-btn end-btn" onclick="updatePCStatus('${labRoom}', ${pcNumber}, 'vacant')">Set as Vacant</button>
                                    </div>
                                `;
                                
                                content += `</div>`;
                                document.getElementById('computerDetailsContent').innerHTML = content;
                        });
                    } else {
                        // No student ID available
                        content += `
                            <div class="detail-item">
                                <span class="detail-label">Assigned To:</span>
                                <span class="detail-value">System assignment</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Purpose:</span>
                                <span class="detail-value">${purpose || 'Not specified'}</span>
                            </div>
                            <div class="detail-actions">
                                <button class="action-btn end-btn" onclick="updatePCStatus('${labRoom}', ${pcNumber}, 'vacant')">Set as Vacant</button>
                            </div>
                        `;
                        
                        content += `</div>`;
                        document.getElementById('computerDetailsContent').innerHTML = content;
                    }
                } else {
                    content += `
                        <div class="detail-actions">
                            <button class="action-btn mark-btn" onclick="updatePCStatus('${labRoom}', ${pcNumber}, 'occupied')">Set as Occupied</button>
                            <button class="action-btn mark-btn" onclick="updatePCStatus('${labRoom}', ${pcNumber}, 'maintenance')">Mark for Maintenance</button>
                        </div>
                    `;
                
                content += `</div>`;
                document.getElementById('computerDetailsContent').innerHTML = content;
                }
                
                document.getElementById('computerDetailsModal').style.display = 'block';
            }
            
            function closeComputerModal() {
                document.getElementById('computerDetailsModal').style.display = 'none';
            }
            
            function updatePCStatus(labRoom, pcNumber, status) {
                fetch('/admin/update_pc_status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `lab_room=${encodeURIComponent(labRoom)}&pc_number=${encodeURIComponent(pcNumber)}&status=${encodeURIComponent(status)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        closeComputerModal();
                        displayComputers(labRoom); // Refresh the grid
                    } else {
                        alert('Failed to update PC status: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to update PC status: ' + error);
                });
            }
            
            // Function to set all PCs in a lab to maintenance mode
            function bulkMaintenance(labRoom) {
                if (confirm('Are you sure you want to set ALL PCs in ' + labRoom + ' to maintenance mode? This will end any active sessions.')) {
                    fetch('/admin/update_pc_status', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `lab_room=${encodeURIComponent(labRoom)}&status=maintenance&is_bulk=true`
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            displayComputers(labRoom); // Refresh the grid
                        } else {
                            alert('Failed to update PC status: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.');
                    });
                }
            }
            
            // Function to set all PCs in a lab to vacant mode
            function bulkVacant(labRoom) {
                if (confirm('Are you sure you want to set all PCs in ' + labRoom + ' to available? This will end any active sessions.')) {
                    fetch('/admin/update_pc_status', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `lab_room=${encodeURIComponent(labRoom)}&status=vacant&is_bulk=true`
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            displayComputers(labRoom); // Refresh the grid
                        } else {
                            alert('Failed to update PC status: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.');
                    });
                }
            }
            
            // Bulk PC Management Functions
            function applyBulkAction() {
                const labRoom = document.getElementById('labRoomFilter').value;
                const pcSelectionFilter = document.getElementById('pcSelectionFilter').value;
                const actionType = document.getElementById('bulkActionType').value;
                
                if (!labRoom) {
                    alert('Please select a lab room first');
                    return;
                }
                
                if (pcSelectionFilter === 'none' || pcSelectionFilter === '') {
                    alert('Please select which PCs to update');
                    return;
                }
                
                if (!actionType) {
                    alert('Please select an action to perform');
                    return;
                }
                
                // Apply the bulk action - directly call server with is_bulk=true
                if (pcSelectionFilter === 'all') {
                    if (confirm(`Are you sure you want to set ALL PCs in ${labRoom} to ${actionType}?`)) {
                        // Show loading indicator
                        document.getElementById('computerControlContent').innerHTML = `
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i> Updating all PCs...
                            </div>
                        `;
                        
                        fetch('/admin/update_pc_status', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: `lab_room=${encodeURIComponent(labRoom)}&status=${encodeURIComponent(actionType)}&is_bulk=true`
                        })
                        .then(response => {
                            if (!response.ok) {
                                return response.json().then(errorData => {
                                    throw new Error(errorData.error || 'Network response was not ok');
                                });
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data.success) {
                                displayComputers(labRoom); // Refresh the grid
                                showToast(`All PCs set to ${actionType} successfully`, 'success');
                            } else {
                                showToast(`Failed to update PC status: ${data.error || 'Unknown error'}`, 'error');
                                // Also reload to be safe
                                displayComputers(labRoom);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            showToast(`An error occurred: ${error.message}`, 'error');
                            // Reload anyway to recover from error
                            displayComputers(labRoom);
                        });
                    }
                    return;
                }
                
                // For selective updates (only available or only occupied PCs), fetch current status first
                // Show loading indicator
                document.getElementById('computerControlContent').innerHTML = `
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i> Updating selected PCs...
                    </div>
                `;
                
                fetch(`/get_pc_status?lab_room=${labRoom}`)
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(errorData => {
                                throw new Error(errorData.error || 'Network response was not ok');
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.error) {
                            throw new Error(data.error);
                        }
                        
                        let updatePromises = [];
                        let pcCount = 0;
                        
                        for (let pcNumber in data.pc_status) {
                            const pcData = data.pc_status[pcNumber];
                            
                            // Filter PCs based on selection
                            if (
                                (pcSelectionFilter === 'available' && pcData.status === 'vacant') ||
                                (pcSelectionFilter === 'occupied' && pcData.status === 'occupied')
                            ) {
                                pcCount++;
                                // Create a request to update each PC
                                const updatePromise = fetch('/admin/update_pc_status', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/x-www-form-urlencoded',
                                    },
                                    body: `lab_room=${encodeURIComponent(labRoom)}&pc_number=${encodeURIComponent(pcNumber)}&status=${encodeURIComponent(actionType)}`
                                }).then(response => response.json());
                                
                                updatePromises.push(updatePromise);
                            }
                        }
                        
                        if (updatePromises.length === 0) {
                            showToast(`No PCs matched the selected filter`, 'warning');
                            displayComputers(labRoom);
                            return;
                        }
                        
                        // Wait for all updates to complete
                        return Promise.all(updatePromises).then(() => pcCount);
                    })
                    .then(pcCount => {
                        if (pcCount) {
                            displayComputers(labRoom); // Refresh the grid
                            showToast(`Updated ${pcCount} PCs successfully`, 'success');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showToast(`An error occurred: ${error.message}`, 'error');
                        // Reload anyway to recover from error
                        displayComputers(labRoom);
                    });
            }
            
            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 500);
                }, 3000);
            }
        </script>
        
        <style>
            /* Computer Control styles */
            .computer-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
                margin-top: 20px;
            }
            
            .computer-item {
                background-color: #f8f9fa;
                border-radius: 8px;
                padding: 15px;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 1px solid #dee2e6;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }
            
            .computer-item:hover {
                transform: translateY(-5px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }
            
            .computer-item.vacant {
                border-left: 5px solid #28a745;
            }
            
            .computer-item.occupied, .computer-item.in-use {
                border-left: 5px solid #dc3545;
            }
            
            .computer-item.maintenance {
                border-left: 5px solid #6c757d;
            }
            
            .computer-icon {
                font-size: 36px;
                color: #495057;
                margin-bottom: 10px;
            }
            
            .computer-name {
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .computer-status {
                font-size: 0.9em;
                color: #6c757d;
            }
            
            .computer-item.vacant .computer-status {
                color: #28a745;
            }
            
            .computer-item.occupied .computer-status, .computer-item.in-use .computer-status {
                color: #dc3545;
            }
            
            .computer-item.maintenance .computer-status {
                color: #6c757d;
            }
            
            .computer-details {
                padding: 15px;
            }
            
            .detail-item {
                margin-bottom: 10px;
                display: flex;
                justify-content: space-between;
                border-bottom: 1px solid #eee;
                padding-bottom: 10px;
            }
            
            .detail-label {
                font-weight: bold;
                color: #495057;
            }
            
            .detail-value {
                color: #6c757d;
            }
            
            .detail-value.vacant {
                color: #28a745;
                font-weight: bold;
            }
            
            .detail-value.occupied, .detail-value.in-use {
                color: #dc3545;
                font-weight: bold;
            }
            
            .detail-value.maintenance {
                color: #6c757d;
                font-weight: bold;
            }
            
            .detail-actions {
                margin-top: 20px;
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }
            
            .end-btn {
                background-color: #dc3545;
            }
            
            .end-btn:hover {
                background-color: #c82333;
            }
            
            .mark-btn {
                background-color: #ffc107;
                color: #212529;
            }
            
            .mark-btn:hover {
                background-color: #e0a800;
            }
            
            /* Toast notifications */
            .toast {
                position: fixed;
                bottom: 20px;
                right: 20px;
                min-width: 250px;
                padding: 15px 20px;
                border-radius: 5px;
                background-color: #333;
                color: white;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 9999;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.3s ease;
            }
            
            .toast.show {
                opacity: 1;
                transform: translateY(0);
            }
            
            .toast-success {
                background-color: #28a745;
            }
            
            .toast-error {
                background-color: #dc3545;
            }
            
            .toast-info {
                background-color: #17a2b8;
            }
        </style>
    </div>

    <!-- Student View Modal - Enhanced design -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeStudentModal()">&times;</span>
            <h2 class="modal-title">Student Information</h2>
            <div id="studentInfo" class="student-info-container">
                <div class="student-profile-card">
                    <div class="profile-picture-container">
                        <img id="modalProfilePic" src="/static/profile_pictures/default.jpg" alt="Profile Picture">
                    </div>
                    <div class="profile-details-container">
                    <h3 id="modalStudentName">Student Name</h3>
                        <div class="detail-item">
                            <i class="fas fa-id-card"></i>
                            <span id="modalStudentID">ID: </span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-graduation-cap"></i>
                            <span id="modalStudentCourse">Course: </span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-user-graduate"></i>
                            <span id="modalStudentYear">Year: </span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-calendar-check"></i>
                            <span id="modalSessionsUsed">Sessions Used: </span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-desktop"></i>
                            <span id="modalPcNumber">PC #: </span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-tasks"></i>
                            <span id="modalPurpose">Purpose: </span>
                        </div>
                    </div>
                </div>
                
                <div class="session-details-card">
                    <h3 class="card-title"><i class="fas fa-clipboard-list"></i> Session Details</h3>
                    <form id="sessionDetailsForm">
                        <input type="hidden" id="sessionId" name="session_id">
                        <input type="hidden" id="currentStudentId" name="student_id">
                        
                        <div class="form-group">
                            <label for="labRoom">Lab Room</label>
                            <select id="labRoom" name="lab_room" class="form-control">
                                <option value="Lab 1">Lab 524</option>
                                <option value="Lab 2">Lab 526</option>
                                <option value="Lab 3">Lab 528</option>
                                <option value="Lab 4">Lab 530</option>
                                <option value="Lab 5">Lab 532</option>
                                <option value="Lab 6">Lab 540</option>
                                <option value="Lab 7">Lab 544</option>
                            </select>
                    </div>
                        
                        <div class="form-group">
                            <label for="purposeSelect">Purpose</label>
                            <select id="purposeSelect" name="purpose_select" class="form-control" onchange="togglePurposeField()">
                                <option value="PHP Programming">PHP Programming</option>
                                <option value="Java Programming">Java Programming</option>
                                <option value="Python Programming">Python Programming</option>
                                <option value="JavaScript Programming">JavaScript Programming</option>
                                <option value="C++ Programming">C++ Programming</option>
                                <option value="C# Programming">C# Programming</option>
                                <option value="Ruby Programming">Ruby Programming</option>
                                <option value="Swift Programming">Swift Programming</option>
                                <option value="Other">Other Purpose</option>
                            </select>
                    </div>
                        
                        <div id="otherPurposeDiv" class="form-group" style="display: none;">
                            <label for="otherPurposeField">Specify Purpose</label>
                            <textarea id="otherPurposeField" name="purpose" class="form-control" rows="3" 
                                placeholder="Please specify the purpose..."></textarea>
                    </div>
                        
                        <button type="button" class="btn-primary" onclick="directSitInStudent()">
                            <i class="fas fa-sign-in-alt"></i> Direct Sit In
                        </button>
                    </form>
                    </div>
                
                <div class="action-buttons-container">
                    <button id="checkInOutBtn" class="action-btn check-btn" style="display: none;">
                        <i class="fas fa-sign-in-alt"></i> Check-In Student
                    </button>
                    <button id="endSessionBtn" class="action-btn end-btn" style="display: none;">
                        <i class="fas fa-times-circle"></i> End All Sessions
                    </button>
                    </div>
                
                <!-- Pending Request Approval Buttons -->
                <div id="pendingRequestButtons" class="approval-buttons-container" style="display: none;">
                    <form id="approveForm" action="" method="POST" style="display: inline;">
                        <button type="submit" class="action-btn approve-btn">
                            <i class="fas fa-sign-in-alt"></i> Check In
                        </button>
                    </form>
                    <form id="rejectForm" action="" method="POST" style="display: inline;">
                        <button type="submit" class="action-btn reject-btn">
                            <i class="fas fa-times-circle"></i> Disapprove
                        </button>
                    </form>
                </div>
                    </div>
                </div>
            </div>
            
    <!-- Direct Sit In Modal -->
    <div id="directSitInModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDirectSitInModal()">&times;</span>
            <h2>Direct Sit In</h2>
            <form action="{{ url_for('direct_sit_in') }}" method="post">
                <div class="form-group">
                    <label for="student_search">Search Student by ID:</label>
                    <div class="search-student-container">
                        <input type="text" id="student_search" class="form-control" placeholder="Enter student ID...">
                        <input type="hidden" id="student_id" name="student_id" required>
                        <div id="student_search_results" class="search-results"></div>
                    </div>
                    <div id="selected_student_info" class="selected-student-info"></div>
                </div>
                
                <div class="form-group">
                    <label for="direct_lab_room">Lab Room</label>
                    <select id="direct_lab_room" name="lab_room" class="form-control" required>
                        <option value="Lab 1">Lab 524</option>
                        <option value="Lab 2">Lab 526</option>
                        <option value="Lab 3">Lab 528</option>
                        <option value="Lab 4">Lab 530</option>
                        <option value="Lab 5">Lab 532</option>
                        <option value="Lab 6">Lab 540</option>
                        <option value="Lab 7">Lab 544</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="purpose_select">Purpose:</label>
                    <select id="purpose_select" name="purpose_select" class="form-control" onchange="togglePurposeField()" required>
                        <option value="">Select Purpose</option>
                        <option value="Project">Project</option>
                        <option value="Assignment">Assignment</option>
                        <option value="Research">Research</option>
                        <option value="Python">Python</option>
                        <option value="Java">Java</option>
                        <option value="C#">C#</option>
                        <option value="C++">C++</option>
                        <option value="JavaScript">JavaScript</option>
                        <option value="PHP">PHP</option>
                        <option value="HTML/CSS">HTML/CSS</option>
                        <option value="SQL">SQL</option>
                        <option value="Other">Other</option>
                    </select>
            </div>
                
                <div class="form-group" id="purpose_field" style="display: none;">
                    <label for="purpose">Specify Purpose:</label>
                    <textarea id="purpose" name="purpose" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Check In Student</button>
                    <button type="button" class="btn btn-secondary" onclick="closeDirectSitInModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add this script tag with a custom type to store JSON data from Jinja -->
    <script id="students-data" type="application/json">
    [
        {% for student in students %}
        {
            "id": {{ student.id }},
            "idno": "{{ student.idno }}",
            "name": "{{ student.lastname }}, {{ student.firstname }}",
            "course": "{{ student.course }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ]
    </script>

    <!-- Add this script tag for chart data -->
    <script id="chart-data" type="application/json">
    {
        "labs": [
            {% for lab in lab_stats %}
            {
                "label": {% if lab.lab_room == 'Lab 1' %}
                "Lab 524"
                {% elif lab.lab_room == 'Lab 2' %}
                "Lab 526"
                {% elif lab.lab_room == 'Lab 3' %}
                "Lab 528"
                {% elif lab.lab_room == 'Lab 4' %}
                "Lab 530"
                {% elif lab.lab_room == 'Lab 5' %}
                "Lab 517"
                {% elif lab.lab_room == 'Lab 10' %}
                "Lab 542"
                {% elif lab.lab_room == 'Lab 11' %}
                "Lab 544"
                {% else %}
                "{{ lab.lab_room }}"
                {% endif %},
                "count": {{ lab.count }}
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        "reports": {
            "totalStudents": {{ students|length }},
            "currentSitIns": {{ active_sessions|length|default(0) }},
            "activePendingSessions": {{ active_sessions|length + pending_sessions|length }}
        },
        "courses": {
            "bsit": {{ students|selectattr('course', 'equalto', '1')|list|length }},
            "bscs": {{ students|selectattr('course', 'equalto', '2')|list|length }},
            "bsce": {{ students|selectattr('course', 'equalto', '3')|list|length }},
            "other": {{ students|rejectattr('course', 'in', ['1', '2', '3'])|list|length }}
        },
        "status": {
            "active": {{ active_sessions|selectattr('status', 'equalto', 'active')|list|length }},
            "pending": {{ pending_sessions|length }},
            "completed": {{ active_sessions|selectattr('status', 'equalto', 'completed')|list|length }},
            "cancelled": {{ active_sessions|selectattr('status', 'equalto', 'cancelled')|list|length }}
        }
    }
    </script>

    <script>
        // Auto-hide flash messages after 5 seconds
        setTimeout(function() {
            var flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                message.style.opacity = '0';
                setTimeout(function() {
                    message.style.display = 'none';
                }, 500);
            });
        }, 5000);
        
        // Tab functionality
        function showTab(tabId) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.style.display = 'none';
            });
            
            // Map old tab IDs to new ones if needed
            if (tabId === 'pending' || tabId === 'pendingRequestsTab') {
                tabId = 'forms';
                
                // Scroll to pending requests section after tab changes
                setTimeout(() => {
                    const pendingSection = document.querySelector('#forms .admin-card:first-child');
                    if (pendingSection) {
                        pendingSection.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            }
            
            // Show the selected tab content
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // Update active state on tab buttons
            const tabButtons = document.querySelectorAll('.nav-item');
            tabButtons.forEach(button => {
                if (button.getAttribute('onclick').includes(`showTab('${tabId}')`) || 
                    button.getAttribute('onclick').includes(`showTab("${tabId}")`)) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Store active tab in URL hash
            window.location.hash = tabId;
        }
        
        // Search functions
        function searchStudents() {
            var input, filter, table, tr, td, i, j, txtValue, found;
            input = document.getElementById("studentSearchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("studentsTable");
            tr = table.getElementsByTagName("tr");
            
            for (i = 1; i < tr.length; i++) {
                found = false;
                td = tr[i].getElementsByTagName("td");
                for (j = 0; j < td.length; j++) {
                    if (td[j]) {
                        txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
                if (found) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
        
        // Search functionality for sessions
        function searchSessions() {
            const searchTerm = document.getElementById('sessionSearchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#sessions .student-table tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Search functionality for pending requests
        function searchPending() {
            const searchTerm = document.getElementById('pendingSearchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#pending .student-table tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Search functionality for feedback
        function searchFeedback() {
            const searchTerm = document.getElementById('feedbackSearchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#feedback .student-table tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportDate = document.getElementById('reportDate').value;
            
            if (!reportDate) {
                alert('Please select a date for the report');
                return;
            }
            
            alert('Generating ' + reportType + ' report for ' + reportDate);
            
            // In a real implementation, this would make an AJAX call to the server
            // to generate the report based on the selected type and date
        }
        
        // Export report
        function exportReport(format) {
            if (format === 'pdf') {
                printReport(); // Use the print function for PDF export
            } else {
                window.location.href = '/export-report/' + format;
            }
        }
        
        // Print report
        function printReport() {
            // Create a printable version
            const reportTitle = document.getElementById('reportType').value;
            const printContent = document.getElementById('reportContent').cloneNode(true);
            
            // Store current body content
            const originalContent = document.body.innerHTML;
            
            // Build HTML content with document.createElement instead of string concatenation
            const tempDiv = document.createElement('div');
            
            // Add styles
            const styleEl = document.createElement('style');
            styleEl.textContent = 
                'body { font-family: Arial, sans-serif; padding: 20px; }' +
                'table { width: 100%; border-collapse: collapse; margin: 20px 0; }' +
                'th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }' +
                'th { background-color: #003366; color: white; }' +
                'h2, h3 { color: #333; margin-top: 20px; }' +
                '@media print { button { display: none; } }';
            tempDiv.appendChild(styleEl);
            
            // Add header
            const headerDiv = document.createElement('div');
            headerDiv.style.textAlign = 'center';
            headerDiv.style.marginBottom = '30px';
            
            const logo = document.createElement('img');
            logo.src = '/static/CSS.png';
            logo.alt = 'CSS Logo';
            logo.style.maxWidth = '100px';
            logo.style.margin = '0 auto';
            logo.style.display = 'block';
            headerDiv.appendChild(logo);
            
            const title = document.createElement('h1');
            title.textContent = 'CSS SIT-IN MONITORING SYSTEM';
            headerDiv.appendChild(title);
            
            const subtitle = document.createElement('h2');
            subtitle.textContent = reportTitle.charAt(0).toUpperCase() + reportTitle.slice(1) + ' Report';
            headerDiv.appendChild(subtitle);
            
            tempDiv.appendChild(headerDiv);
            
            // Add date
            const dateDiv = document.createElement('div');
            dateDiv.style.textAlign = 'right';
            dateDiv.style.fontStyle = 'italic';
            dateDiv.style.marginBottom = '20px';
            dateDiv.textContent = 'Generated on: ' + new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString();
            tempDiv.appendChild(dateDiv);
            
            // Add content
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = printContent.innerHTML;
            tempDiv.appendChild(contentDiv);
            
            // Add buttons
            const buttonDiv = document.createElement('div');
            buttonDiv.style.display = 'flex';
            buttonDiv.style.justifyContent = 'center';
            buttonDiv.style.marginTop = '30px';
            buttonDiv.style.gap = '20px';
            
            const printBtn = document.createElement('button');
            printBtn.textContent = 'Print Report';
            printBtn.style.padding = '10px 20px';
            printBtn.style.background = '#4CAF50';
            printBtn.style.color = 'white';
            printBtn.style.border = 'none';
            printBtn.style.cursor = 'pointer';
            printBtn.style.borderRadius = '5px';
            printBtn.onclick = function() { window.print(); };
            buttonDiv.appendChild(printBtn);
            
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.style.padding = '10px 20px';
            cancelBtn.style.background = '#f44336';
            cancelBtn.style.color = 'white';
            cancelBtn.style.border = 'none';
            cancelBtn.style.cursor = 'pointer';
            cancelBtn.style.borderRadius = '5px';
            cancelBtn.onclick = function() { window.location.reload(); };
            buttonDiv.appendChild(cancelBtn);
            
            tempDiv.appendChild(buttonDiv);
            
            // Replace with printable content
            document.body.innerHTML = tempDiv.innerHTML;
            
            // After print dialog closed, restore original content
            window.onafterprint = function() {
                document.body.innerHTML = originalContent;
            };
        }
        
        // Save settings
        function saveSettings() {
            const maxSessionsBSIT = document.getElementById('maxSessionsBSIT').value;
            const maxSessionsBSCS = document.getElementById('maxSessionsBSCS').value;
            const maxSessionsBSCE = document.getElementById('maxSessionsBSCE').value;
            const maxSessionsOther = document.getElementById('maxSessionsOther').value;
            const adminPassword = document.getElementById('adminPassword').value;
            
            alert('Settings saved successfully.');
            
            // In a real implementation, this would make an AJAX call to the server
            // to update the settings in the database
        }
        
        // Student modal functions
        async function viewStudent(studentId, sessionId = null) {
            try {
                // Fetch student data
                fetch(`/admin/get-student-info/${studentId}`)
                .then(response => {
                    if (!response.ok) {
                            throw new Error('Could not fetch student data');
                    }
                    return response.json();
                })
                .then(student => {
                    // Populate student info (same as above)
                    document.getElementById('modalStudentName').textContent = `${student.firstname} ${student.lastname}`;
                    document.getElementById('modalStudentID').textContent = `ID: ${student.idno}`;
                    
                    let courseName = '';
                    if (student.course === '1') courseName = 'BSIT';
                    else if (student.course === '2') courseName = 'BSCS';
                    else if (student.course === '3') courseName = 'BSCE';
                    else courseName = student.course;
                    
                    document.getElementById('modalStudentCourse').textContent = `Course: ${courseName}`;
                    document.getElementById('modalStudentYear').textContent = `Year: ${student.year_level}`;
                    document.getElementById('modalSessionsUsed').textContent = `Sessions Used: ${student.sessions_used}/${student.max_sessions}`;
                    
                    if (student.profile_picture) {
                        document.getElementById('modalProfilePic').src = `/static/profile_pictures/${student.profile_picture}`;
                    } else {
                        document.getElementById('modalProfilePic').src = `/static/profile_pictures/default.jpg`;
                    }
                    
                    // Set the student ID in the hidden field
                    document.getElementById('currentStudentId').value = studentId;
                    
                    // Hide pending request buttons by default
                    document.getElementById('pendingRequestButtons').style.display = 'none';
                    
                    // Regular student view (not pending request)
                    if (sessionId) {
                        document.getElementById('sessionId').value = sessionId;
                        document.getElementById('checkInOutBtn').style.display = 'inline-block';
                        document.getElementById('endSessionBtn').style.display = 'inline-block';
                        
                        // Configure check in/out button based on current status
                        const checkInOutBtn = document.getElementById('checkInOutBtn');
                        const hasActiveSession = student.active_sessions && student.active_sessions.length > 0;
                        
                        if (hasActiveSession) {
                            // Check if any active session is already checked in
                            const checkedInSession = student.active_sessions.find(s => s.check_in_time && !s.check_out_time);
                            
                            if (checkedInSession) {
                                checkInOutBtn.textContent = 'Check-Out Student';
                                checkInOutBtn.onclick = function() {
                                    window.location.href = `/admin/check-out/${checkedInSession.id}`;
                                };
                            } else {
                                checkInOutBtn.textContent = 'Check-In Student';
                                checkInOutBtn.onclick = function() {
                                    window.location.href = `/admin/check-in/${sessionId}`;
                                };
                            }
                        } else {
                            checkInOutBtn.style.display = 'none';
                        }
                        
                        // Configure end session button
                        document.getElementById('endSessionBtn').onclick = function() {
                            if (confirm('Are you sure you want to end all active sessions for this student?')) {
                                window.location.href = `/admin/end-student-session/${studentId}`;
                            }
                        };
                    } else {
                        document.getElementById('checkInOutBtn').style.display = 'none';
                        document.getElementById('endSessionBtn').style.display = 'none';
                    }
                    
                    // Show modal
                    document.getElementById('studentModal').style.display = 'block';
                })
                .catch(error => {
                        console.error('Error fetching student data:', error);
                        alert('Failed to load student information');
                });
            } catch (error) {
                console.error('Error fetching student data:', error);
                alert('Failed to load student information');
            }
        }
        
        function closeStudentModal() {
            document.getElementById('studentModal').style.display = 'none';
        }
        
        // Toggle purpose textarea based on selection
        function togglePurposeTextarea() {
            const purposeSelect = document.getElementById('purposeSelect');
            const otherPurposeDiv = document.getElementById('otherPurposeDiv');
            
            if (purposeSelect.value === 'Other') {
                otherPurposeDiv.style.display = 'block';
            } else {
                otherPurposeDiv.style.display = 'none';
            }
        }
        
        // End student session
        function endStudentSession(sessionId) {
            if (confirm('Are you sure you want to end this session?')) {
                // Send request to end the session
                fetch('/admin/complete-session/' + sessionId, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to end session');
                    }
                    alert('Session has been ended successfully');
                    // Refresh the modal content
                    const studentId = document.getElementById('modalStudentID').getAttribute('data-student-id');
                    if (studentId) {
                        viewStudent(studentId);
                    } else {
                        closeStudentModal();
                        location.reload(); // Reload the page if we can't refresh the modal
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to end session: ' + error.message);
                });
            }
        }
        
        // End all sessions for a student
        function endAllStudentSessions(studentId) {
            if (confirm('Are you sure you want to end all active sessions for this student?')) {
                // Send request to end all sessions
                fetch('/admin/end-student-session/' + studentId, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to end sessions');
                    }
                    alert('All sessions have been ended successfully');
                    closeStudentModal();
                    location.reload(); // Reload the page to reflect changes
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to end sessions: ' + error.message);
                });
            }
        }

        function editStudent(id) {
            // Edit student details
            alert('Editing student with ID: ' + id);
        }

        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student? This will also delete all their sessions and feedback. This action cannot be undone.')) {
                // Create a form to submit the delete request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/admin/delete-student/' + id;
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('studentModal');
            if (event.target == modal) {
                closeStudentModal();
            }
        }

        // Function to update session details
        async function updateSessionDetails() {
            const sessionId = document.getElementById('sessionId').value;
            if (!sessionId) {
                alert('No active session selected');
                return;
            }
            
            const labRoom = document.getElementById('labRoom').value;
            const purposeSelect = document.getElementById('purposeSelect').value;
            let finalPurpose = purposeSelect;
            
            // If "Other" is selected, use the text from the textarea
            if (purposeSelect === 'Other') {
                finalPurpose = document.getElementById('otherPurposeField').value;
                if (!finalPurpose.trim()) {
                    alert('Please specify a purpose');
                    return;
                }
            }
            
            try {
                const response = await fetch(`/admin/update-session/${sessionId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `lab_room=${encodeURIComponent(labRoom)}&programming_language=${encodeURIComponent("")}&purpose=${encodeURIComponent(finalPurpose)}`
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update session');
                }
                
                alert('Session details updated successfully');
                
                // Add approve button if it's in pending section
                const pendingRow = document.querySelector(`tr[data-session-id="${sessionId}"]`);
                if (pendingRow) {
                    const actionsCell = pendingRow.querySelector('.action-buttons');
                    
                    // Check if approve button already exists
                    const existingApproveButton = actionsCell.querySelector('.approve-btn');
                    if (!existingApproveButton) {
                        const approveForm = document.createElement('form');
                        approveForm.action = `/approve-session/${sessionId}`;
                        approveForm.method = 'POST';
                        approveForm.style.display = 'inline';
                        
                        const approveButton = document.createElement('button');
                        approveButton.type = 'submit';
                        approveButton.className = 'action-btn view-btn approve-btn';
                        approveButton.textContent = 'Approve';
                        
                        approveForm.appendChild(approveButton);
                        actionsCell.appendChild(approveForm);
                        
                        // Add reject button if not present
                        const existingRejectButton = actionsCell.querySelector('.delete-btn');
                        if (!existingRejectButton) {
                            const rejectForm = document.createElement('form');
                            rejectForm.action = `/reject-session/${sessionId}`;
                            rejectForm.method = 'POST';
                            rejectForm.style.display = 'inline';
                            
                            const rejectButton = document.createElement('button');
                            rejectButton.type = 'submit';
                            rejectButton.className = 'action-btn delete-btn';
                            rejectButton.textContent = 'Reject';
                            
                            rejectForm.appendChild(rejectButton);
                            actionsCell.appendChild(rejectForm);
                        }
                    }
                }
                
                // Refresh the modal content
                const studentId = document.getElementById('modalStudentID').getAttribute('data-student-id');
                if (studentId) {
                    viewStudent(studentId);
                } else {
                    closeStudentModal();
                    location.reload(); // Reload the page if we can't refresh the modal
                }
            } catch (error) {
                console.error('Error updating session:', error);
                alert('Could not update session. Please try again.');
            }
        }

        // Function to show Direct Sit In modal
        function showDirectSitInModal() {
            document.getElementById('directSitInModal').style.display = 'block';
            // Clear previous search results and selection
            document.getElementById('student_search').value = '';
            document.getElementById('student_id').value = '';
            document.getElementById('selected_student_info').innerHTML = '';
            document.getElementById('student_search_results').innerHTML = '';
        }
        
        // Function to close Direct Sit In modal
        function closeDirectSitInModal() {
            document.getElementById('directSitInModal').style.display = 'none';
        }
        
        // Toggle purpose textarea for Direct Sit In
        function togglePurposeField() {
            const purposeSelect = document.getElementById('purpose_select');
            const purposeField = document.getElementById('purpose_field');
            
            if (purposeSelect.value === 'Other') {
                purposeField.style.display = 'block';
            } else {
                purposeField.style.display = 'none';
            }
        }
        
        // Create Direct Sit In from student modal
        function createDirectSitIn() {
            const studentId = document.getElementById('modalStudentID').getAttribute('data-student-id');
            if (!studentId) {
                alert("No student selected");
                return;
            }
            
            // Close current modal and open direct sit in modal
            closeStudentModal();
            showDirectSitInModal();
            
            // Pre-select the student
            const studentSelect = document.getElementById('studentSelect');
            for (let i = 0; i < studentSelect.options.length; i++) {
                if (studentSelect.options[i].value === studentId) {
                    studentSelect.selectedIndex = i;
                    break;
                }
            }
        }

        // Function to search for students by ID
        function searchStudentById() {
            const searchInput = document.getElementById('student_search');
            const searchTerm = searchInput.value.trim();
            const searchResults = document.getElementById('student_search_results');
            
            if (searchTerm.length < 1) {
                searchResults.innerHTML = '';
                return;
            }
            
            // Get students data from the JSON script tag
            const studentsData = JSON.parse(document.getElementById('students-data').textContent);
            
            // Filter students by ID number
            const matchingStudents = studentsData.filter(student => 
                student.idno.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            // Display search results
            if (matchingStudents.length > 0) {
                let resultsHtml = '';
                matchingStudents.forEach(student => {
                    resultsHtml += `<div class="search-result-item" onclick="selectStudent(${student.id}, '${student.idno}', '${student.name}', '${student.course}')">
                        ${student.idno} - ${student.name}
                    </div>`;
                });
                searchResults.innerHTML = resultsHtml;
                searchResults.style.display = 'block';
            } else {
                searchResults.innerHTML = '<div class="no-results">No matching students found</div>';
                searchResults.style.display = 'block';
            }
        }
        
        // Function to select a student from search results
        function selectStudent(id, idno, name, course) {
            document.getElementById('student_id').value = id;
            document.getElementById('selected_student_info').innerHTML = `
                <div class="selected-student-header">Selected Student:</div>
                <div class="selected-student-details">
                    <div class="student-id">${idno}</div>
                    <div class="student-name">${name}</div>
                    <div class="student-course">${course == '1' ? 'BSIT' : course == '2' ? 'BSCS' : course == '3' ? 'BSCE' : course}</div>
                </div>
            `;
            document.getElementById('selected_student_info').style.display = 'block';
            document.getElementById('student_search_results').innerHTML = '';
            document.getElementById('student_search_results').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize student search
            const studentSearch = document.getElementById('student_search');
            if (studentSearch) {
                studentSearch.addEventListener('input', searchStudentById);
            }
            
            // Fix current sessions tab background and navigation
            const sessionsTab = document.querySelector('.nav-item[onclick="showTab(\'sessions\')"]');
            if (sessionsTab) {
                sessionsTab.addEventListener('click', function() {
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    document.getElementById('sessions').classList.add('active');
                    
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            }
            
            // Initialize charts with data from JSON
            try {
                const chartData = JSON.parse(document.getElementById('chart-data').textContent);
                
                // Lab Usage Chart
                const labUsageCtx = document.getElementById('labRoomChart').getContext('2d');
                const labUsageChart = new Chart(labUsageCtx, {
                type: 'pie',
                data: {
                        labels: chartData.labs.map(lab => lab.label),
                    datasets: [{
                            data: chartData.labs.map(lab => lab.count),
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#C9CBCF']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${value} sessions (${percentage}%)`;
                                    }
                                }
                        }
                    }
                }
            });
            
                // Report Stats Chart
                const reportStatsCtx = document.getElementById('reportStatsChart').getContext('2d');
                const reportStatsChart = new Chart(reportStatsCtx, {
                    type: 'doughnut',
                data: {
                        labels: ['Total Students', 'Current Sit-ins', 'Active+Pending Sessions'],
                    datasets: [{
                            data: [
                                chartData.reports.totalStudents,
                                chartData.reports.currentSitIns,
                                chartData.reports.activePendingSessions
                            ],
                            backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.raw}`;
                                    }
                                }
                        }
                    }
                }
            });
            
            // Course Chart
            const courseCtx = document.getElementById('courseChart').getContext('2d');
            const courseChart = new Chart(courseCtx, {
                type: 'pie',
                data: {
                        labels: ['BSIT', 'BSCS', 'BSCE', 'Other'],
                    datasets: [{
                            data: [
                                chartData.courses.bsit,
                                chartData.courses.bscs,
                                chartData.courses.bsce,
                                chartData.courses.other
                            ],
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#C9CBCF']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${value} students (${percentage}%)`;
                                    }
                                }
                        }
                    }
                }
            });
            
            // Status Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            const statusChart = new Chart(statusCtx, {
                type: 'pie',
                data: {
                        labels: ['Active', 'Pending', 'Completed', 'Cancelled'],
                    datasets: [{
                            data: [
                                chartData.status.active,
                                chartData.status.pending,
                                chartData.status.completed,
                                chartData.status.cancelled
                            ],
                            backgroundColor: ['#28a745', '#ffc107', '#17a2b8', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${value} sessions (${percentage}%)`;
                                    }
                                }
                        }
                    }
                }
            });
            } catch (error) {
                console.error('Error initializing charts:', error);
            }
        });

        // Add search functionality for forms
        function searchForms() {
            const searchTerm = document.getElementById('formsSearchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#forms .student-table tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Add this to your existing JavaScript code
        function viewPendingRequest(sessionId, name, idno, course, pcNumber, purpose, studentId) {
            fetch(`/admin/get-student-info/${studentId}`)
                .then(response => response.json())
                .then(data => {
                    // Populate student info
                    const studentData = data.student || {};
                    document.getElementById('modalStudentName').textContent = name || `${studentData.firstname || ''} ${studentData.lastname || ''}`;
                    document.getElementById('modalStudentID').textContent = `ID: ${idno || studentData.idno || 'N/A'}`;
                    
                    let courseName = '';
                    if (course === '1') courseName = 'BSIT';
                    else if (course === '2') courseName = 'BSCS';
                    else if (course === '3') courseName = 'BSCE';
                    else courseName = course || studentData.course || 'N/A';
                    
                    document.getElementById('modalStudentCourse').textContent = `Course: ${courseName}`;
                    document.getElementById('modalStudentYear').textContent = `Year: ${studentData.year_level || 'N/A'}`;
                    document.getElementById('modalSessionsUsed').textContent = `Sessions Used: ${studentData.sessions_used || 0}/${studentData.max_sessions || 0}`;
                    
                    // Add PC number and purpose
                    document.getElementById('modalPcNumber').textContent = `PC #: ${pcNumber || 'N/A'}`;
                    document.getElementById('modalPurpose').textContent = `Purpose: ${purpose || 'N/A'}`;
                    
                    if (studentData.profile_picture) {
                        document.getElementById('modalProfilePic').src = `/static/profile_pictures/${studentData.profile_picture}`;
                    } else {
                        document.getElementById('modalProfilePic').src = `/static/profile_pictures/default.jpg`;
                    }
                    
                    // Hide regular action buttons and show pending request buttons
                    document.getElementById('checkInOutBtn').style.display = 'none';
                    document.getElementById('endSessionBtn').style.display = 'none';
                    document.getElementById('pendingRequestButtons').style.display = 'block';
                    
                    // Set the form actions for approve/reject buttons
                    document.getElementById('approveForm').action = `/admin/check-in-student/${sessionId}`;
                    document.getElementById('rejectForm').action = `/admin/reject-session/${sessionId}`;
                    
                    // Show modal
                    document.getElementById('studentModal').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching student info:', error);
                    alert('Failed to load student information');
                });
        }

        // Function for direct sit-in
        async function directSitInStudent() {
            const studentId = document.getElementById('currentStudentId').value;
            const labRoom = document.getElementById('labRoom').value;
            const purposeSelect = document.getElementById('purposeSelect').value;
            let purpose = '';
            
            // If "Other" is selected, use the text from the textarea
            if (purposeSelect === 'Other') {
                purpose = document.getElementById('otherPurposeField').value;
                if (!purpose.trim()) {
                    alert('Please specify a purpose');
                    return;
                }
            }
            
            // Create a form and submit it
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = "{{ url_for('direct_sit_in') }}";
            form.style.display = 'none';

            // Add student ID
            const studentIdInput = document.createElement('input');
            studentIdInput.type = 'hidden';
            studentIdInput.name = 'student_id';
            studentIdInput.value = studentId;
            form.appendChild(studentIdInput);

            // Add lab room
            const labRoomInput = document.createElement('input');
            labRoomInput.type = 'hidden';
            labRoomInput.name = 'lab_room';
            labRoomInput.value = labRoom;
            form.appendChild(labRoomInput);

            // Add purpose select
            const purposeSelectInput = document.createElement('input');
            purposeSelectInput.type = 'hidden';
            purposeSelectInput.name = 'purpose_select';
            purposeSelectInput.value = purposeSelect;
            form.appendChild(purposeSelectInput);

            // Add purpose if needed
            if (purposeSelect === 'Other') {
                const purposeInput = document.createElement('input');
                purposeInput.type = 'hidden';
                purposeInput.name = 'purpose';
                purposeInput.value = purpose;
                form.appendChild(purposeInput);
            }

            // Add to document and submit
            document.body.appendChild(form);
            form.submit();
        }
        
        // Edit announcement functionality
        function editAnnouncement(announcementId) {
            fetch(`/admin/get-announcement/${announcementId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('edit_announcement_id').value = data.id;
                    document.getElementById('edit_title').value = data.title;
                    document.getElementById('edit_content').value = data.content;
                    document.getElementById('editAnnouncementModal').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error fetching announcement data');
                });
        }
        
        // Close edit announcement modal
        function closeEditAnnouncementModal() {
            document.getElementById('editAnnouncementModal').style.display = 'none';
        }
    </script>
    
    <!-- Edit Announcement Modal -->
    <div id="editAnnouncementModal" class="modal" style="display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); padding-top: 60px;">
        <div class="modal-content" style="background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <span class="close" onclick="closeEditAnnouncementModal()" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h2 style="margin-top: 0; color: var(--primary-color);">Edit Announcement</h2>
            <form action="{{ url_for('edit_announcement') }}" method="POST">
                <input type="hidden" id="edit_announcement_id" name="announcement_id">
                <div style="margin-bottom: 15px;">
                    <label for="edit_title" style="display: block; margin-bottom: 5px; font-weight: 600;">Title</label>
                    <input type="text" id="edit_title" name="title" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="edit_content" style="display: block; margin-bottom: 5px; font-weight: 600;">Content</label>
                    <textarea id="edit_content" name="content" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 150px;" rows="5" required></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeEditAnnouncementModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    // ... existing scripts ...

    // Edit announcement functionality
    function editAnnouncement(announcementId) {
        fetch(`/admin/get-announcement/${announcementId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('edit_announcement_id').value = data.id;
                document.getElementById('edit_title').value = data.title;
                document.getElementById('edit_content').value = data.content;
                document.getElementById('editAnnouncementModal').style.display = 'block';
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error fetching announcement data');
            });
    }

    // Close edit announcement modal
    function closeEditAnnouncementModal() {
        document.getElementById('editAnnouncementModal').style.display = 'none';
    }

    // Close modal when clicking outside of it
    window.onclick = function(event) {
        const modal = document.getElementById('editAnnouncementModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    </script>

    <script>
        // Existing scripts...
        
        // Dropdown menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            const dropdown = document.querySelector('.nav-dropdown');
            if (dropdown) {
                dropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                    this.classList.toggle('active');
                });
                
                // Close dropdown when clicking elsewhere
                document.addEventListener('click', function() {
                    dropdown.classList.remove('active');
                });
            }
        });
    </script>

    <script>
        // Auto-hide flash messages after 5 seconds
        setTimeout(function() {
            var flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                message.style.opacity = '0';
                setTimeout(function() {
                    message.style.display = 'none';
                }, 500);
            });
        }, 5000);

        // Function to search in the logs table
        function searchLogs() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("logsSearchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("logsTableBody").parentElement;
            tr = table.getElementsByTagName("tr");
            
            for (i = 0; i < tr.length; i++) {
                var found = false;
                // Skip first row (header)
                if (tr[i].getElementsByTagName("td").length > 0) {
                    // Loop through all cells in the row
                    var tds = tr[i].getElementsByTagName("td");
                    for (var j = 0; j < tds.length; j++) {
                        td = tds[j];
                        if (td) {
                            txtValue = td.textContent || td.innerText;
                            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                found = true;
                                break;
                            }
                        }
                    }
                    tr[i].style.display = found ? "" : "none";
                }
            }
        }
    </script>

    <!-- Reservation Logs Tab for displaying completed, cancelled and rejected sessions -->
    <div id="reservationLogs" class="tab-content">
        <h2>Reservation Logs</h2>
        
        <div class="search-bar">
            <input type="text" id="logsSearchInput" class="search-input" placeholder="Search logs by name, ID, or status...">
            <button class="search-btn" onclick="searchLogs()">Search</button>
        </div>
        
        <table class="student-table">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Name</th>
                    <th>Course</th>
                    <th>Lab Room</th>
                    <th>Date & Time</th>
                    <th>Purpose</th>
                    <th>Status</th>
                    <th>Created At</th>
                </tr>
            </thead>
            <tbody>
                {% if reservation_logs|length > 0 %}
                    {% for session in reservation_logs %}
                        <tr>
                            <td>{{ session.idno }}</td>
                            <td>{{ session.lastname }}, {{ session.firstname }}</td>
                            <td>
                                {% if session.course == '1' %}
                                    BSIT
                                {% elif session.course == '2' %}
                                    BSCS
                                {% elif session.course == '3' %}
                                    BSCE
                                {% else %}
                                    {{ session.course }}
                                {% endif %}
                            </td>
                            <td>{{ session.lab_room|lab_room }}</td>
                            <td>{{ session.date_time_formatted }}</td>
                            <td>{{ session.purpose.split(' - PC #')[0]|default(session.purpose)|truncate(30) }}</td>
                            <td>
                                {% if session.approval_status == 'rejected' %}
                                    <span class="status-rejected">Rejected</span>
                                {% elif session.approval_status == 'approved' %}
                                    <span class="status-approved">Approved</span>
                                {% elif session.approval_status == 'pending' %}
                                    <span class="status-pending">Pending</span>
                                {% else %}
                                    <span class="status-{{ session.approval_status }}">{{ session.approval_status|capitalize }}</span>
                                {% endif %}
                            </td>
                            <td>{{ session.created_at.strftime('%Y-%m-%d %H:%M') if session.created_at else 'N/A' }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="8" style="text-align: center;">No reservation logs found</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Reports Tab -->
</body>
<script src="/static/js/admin.js"></script>
<script>
// Close modal when clicking outside of it
window.onclick = function(event) {
    const modal = document.getElementById('editAnnouncementModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
</script>
<script>
// Function to filter reports by date range
function filterReportsByDate() {
    const startDate = document.getElementById('reportStartDate').value;
    const endDate = document.getElementById('reportEndDate').value;
    
    if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
    }
    
    // Update export buttons with date parameters
    const excelBtn = document.getElementById('exportExcelBtn');
    const csvBtn = document.getElementById('exportCSVBtn');
    const pdfBtn = document.getElementById('exportPDFBtn');
    
    // Update URLs with date parameters
    excelBtn.href = `{{ url_for('export_report', format='excel') }}?start_date=${startDate}&end_date=${endDate}`;
    csvBtn.href = `{{ url_for('export_report', format='csv') }}?start_date=${startDate}&end_date=${endDate}`;
    pdfBtn.href = `{{ url_for('export_report', format='pdf') }}?start_date=${startDate}&end_date=${endDate}`;
    
    // Show feedback to user
    alert(`Reports filtered from ${startDate} to ${endDate}. Click on export buttons to download filtered reports.`);
}
</script>
</html> 
